{% extends "base.html" %}
{% block content %}

<!-- HERO -->
<div class="hero">

  <div class="hero-card">
    <h1>Pesquisas brasileiras, em linguagem clara.</h1>

    <p class="muted">
      PublicaÃ§Ãµes curtas, citÃ¡veis e com fonte original.
      CiÃªncia acessÃ­vel â€” sem perder o rigor.
    </p>

    <!-- FILTRO -->
    <form action="{{ url_for('index') }}" method="get" class="search-bar" id="areaForm">
      <select name="area" id="areaSelect">
        <option value="">Todas as Ã¡reas</option>
        {% for a in areas %}
          <option value="{{ a }}" {% if filtro_area == a %}selected{% endif %}>
            {{ a }}
          </option>
        {% endfor %}
      </select>

      <button type="submit" class="btn">
        Filtrar
      </button>
    </form>

    <div class="filters-area">
      <span class="muted" style="font-size: .85rem; font-weight:700;">
        Populares:
      </span>

      <a href="{{ url_for('index', area='SaÃºde') }}" class="chip">SaÃºde</a>
      <a href="{{ url_for('index', area='Tecnologia') }}" class="chip">Tecnologia</a>

      <a href="{{ url_for('index') }}" class="chip" style="background:#fff;">
        Limpar
      </a>
    </div>

  </div>


  <!-- REGRA DE OURO -->
  <div class="callout">
    <div class="callout-icon">ğŸ’¡</div>

    <div>
      <span class="callout-title">A regra de ouro</span>

      <p style="margin:0;">
        Explique sua descoberta como se fosse em um
        <b>almoÃ§o de domingo</b>.
      </p>

      <p class="muted" style="margin-top:8px;">
        Pense em 3 partes:
        <b>o que Ã©</b> â€¢ <b>por que importa</b> â€¢ <b>o que muda</b>
      </p>
    </div>
  </div>

</div>


<!-- GRID -->
<section class="grid">

{% if not pesquisas %}

  <!-- EMPTY STATE PREMIUM -->
  <div class="card" style="grid-column: 1 / -1; text-align:center; padding: 50px;">

    <div style="font-size:52px;">ğŸŒ±</div>

    <h2 style="margin-top:10px;">
      Ainda nÃ£o hÃ¡ pesquisas{% if filtro_area %} em <b>{{ filtro_area }}</b>{% endif %}.
    </h2>

    <p class="muted">
      O IpÃª comeÃ§a com quem publica.
      Seja a primeira voz cientÃ­fica aqui.
    </p>

    {% if current_user.is_authenticated %}
      <a class="btn" href="{{ url_for('publicar') }}">
        Publicar pesquisa
      </a>
    {% else %}
      <a class="btn" href="{{ url_for('register') }}">
        Criar conta gratuita
      </a>

      <p class="muted" style="margin-top:10px;">
        JÃ¡ possui conta?
        <a href="{{ url_for('login') }}" style="font-weight:800;">
          Entrar
        </a>
      </p>
    {% endif %}

  </div>

{% endif %}



{% for p in pesquisas %}

<article class="card">

  <div class="card-header">
    <span class="badge-area">{{ p["area"] }}</span>

    <span class="badge-evidencia {{ p['evidencia']|lower }}">
      {{ p["evidencia"] }}
    </span>
  </div>

  <h2 class="card-title">
    {{ p["titulo"] }}
  </h2>

  {% if p["imagem_url"] %}
    <img
      src="{{ p['imagem_url'] }}"
      class="card-img"
      loading="lazy"
      alt="Imagem da pesquisa"
    >
  {% endif %}

  <p>
    <b>O que Ã©:</b>
    <span class="muted">
      {{ p["descoberta"][:220] }}
      {% if p["descoberta"]|length > 220 %}...{% endif %}
    </span>
  </p>

  <div class="actions">

    <a href="{{ url_for('perfil', nome=p['pesquisador']) }}"
       class="btn-perfil">
       ğŸ‘©â€ğŸ”¬ {{ p["pesquisador"] }}
    </a>

    <!-- ğŸ”¥ PROTEÃ‡ÃƒO PARA LINK -->
    {% if p['link_original'].startswith('http') %}
      <a href="{{ p['link_original'] }}"
         target="_blank"
         rel="noopener noreferrer"
         class="btn-link">
         ğŸ“„ Ver original
      </a>
    {% else %}
      <a href="https://{{ p['link_original'] }}"
         target="_blank"
         rel="noopener noreferrer"
         class="btn-link">
         ğŸ“„ Ver original
      </a>
    {% endif %}

  </div>

</article>

{% endfor %}

</section>


<!-- AUTO SUBMIT FILTRO -->
<script>
(function(){
  const sel = document.getElementById("areaSelect");
  const form = document.getElementById("areaForm");

  if(sel && form){
    sel.addEventListener("change", () => form.submit());
  }
})();
</script>

{% endblock %}
